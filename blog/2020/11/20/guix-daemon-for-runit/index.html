<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>HiPhish's Workshop</title><link rel="stylesheet" href="/css/main.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all" /></head><body><header><nav id="main-navbar"><input type="checkbox" id="main-nav-hamburger" hidden="hidden" /><div><a href="/">HiPhish's Workshop</a><label for="main-nav-hamburger" hidden="hidden"></label></div><ul><li><a href="/grid-framework/">Grid Framework</a><ul><li><a href="/grid-framework/">Overview</a></li><li hidden="hidden"></li><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href="/grid-framework/news/">News</a></li><li hidden="hidden"></li><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li hidden="hidden"></li><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li><a href="/#products">Open Source</a><ul><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/IPS-Tools">IPS-Tools</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li><a href="/vim/plugins/">Vim/Nvim plugins</a><ul><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li><li><a href="https://gitlab.com/HiPhish/neovim-guix-channel/">Guix channel</a></li></ul></li><li class="push-end"><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></nav></header><div><div class="blog"><nav class="breadcrumbs" aria-label="Breadcrumbs"><ol><li class=""><a href="../../../..">blog</a></li><li class=""><a href="../../..">2020</a></li><li class=""><a href="../..">11</a></li><li class="active">20</li><li class="active">guix-daemon-for-runit</li></ol></nav><main class="blogpost"><article><h1><a href="." title="Permalink to A Guix daemon for runit" rel="bookmark">A Guix daemon for runit</a></h1><header><p><time class="published" datetime="2020-11-20">Published: 2020-11-20</time></p><p>Category: <a href="../../../../categories/open-source/">open-source</a></p><p>Tags: <a href="../../../../tags/guix/">guix </a><a href="../../../../tags/linux/">linux </a></p></header><p>I use <a href="http://guix.gnu.org/">GNU Guix</a> as a secondary package manager on my system. Previously I have
been running <a href="https://kubuntu.org/">Kubuntu</a>, which uses <a href="https://systemd.io/">systemd</a> as its init system, but I have
since switched to <a href="https://voidlinux.org/">Void</a>, which uses <a href="http://smarden.org/runit/">runit</a>. Guix comes with services for
systemd and <a href="http://upstart.ubuntu.com/">Upstart</a> included, but not for runit. Let's find out how to create
a runit service from scratch.</p><p>If you wish to follow along you need to know how to use the Unix command line
interface, log in as the <code>root</code> user, how to change the permissions of a file,
and how to control runit services.</p><h2>What is a Guix daemon anyway?</h2><p>A Unix <a href="https://en.wikipedia.org/wiki/Daemon_(computing)">daemon</a> is a background process. It is started and runs on its own
instead of being controlled directly by the users; it usually has some way for
other processes to deliver messages to it so it can perform some task. A daemon
is generally started by the init system, but it can also be started manually.</p><p>The Guix daemon is responsible for downloading and building packages. When you
want to install a package you do not have to use <code>sudo</code>, even though packages
are stored in some system-wide directory. Since a regular user lacks the
permissions to write to the Guix store (where all the packages are stored) this
is what happens roughly: The <code>guix</code> command sends a message to the daemon,
which then <em>on behalf of the user</em> downloads and builds the package. Without
the Guix daemon you would not be able to do anything system-wide.</p><h2>Starting the daemon by hand</h2><p>The Guix manual details how to start the daemon manually.</p><blockquote><p>The <code>guix-daemon</code> program may then be run as <code>root</code> with the following
command:</p><pre><code class="language-sh"># guix-daemon --build-users-group=guixbuild</code></pre></blockquote><p>We can try this. First log in as <code>root</code> in one shell and execute the above
command. The daemon process should be running. Now open a new shell and (as a
regular user) enter <code>guix build hello</code>. You should see the <code>hello</code> package
getting built. You can now terminated the daemon by pressing ctrl-c in its
shell.</p><h2>Writing a runit service</h2><p>A runit service definition is a directory containing executable files with
certain names. The runit documentation covers the details, but for our purose
the only file file that matters is the <code>run</code> file. This file will be executed
when the service is started up, its purpose is to actually run the Guix daemon.
Create the following directory structure:</p><pre><code>/etc
└── sv
    └── guix-daemon
        └── run</code></pre><p>The directory <code>/etc/sv</code> is where services are defined. The name <code>guix-daemon</code>
is arbitrary, you could call your service whatever you want, but I chose the
same name used by systemd and Upstart for consistency.</p><p>The <code>run</code> file can be anything, as long as it is executable. A shell script is
the most logical choice, so that is what I chose.</p><pre><code class="language-sh">#!/bin/sh
exec ~root/.config/guix/current/bin/guix-daemon --build-users-group=guixbuild</code></pre><p>That is it. Note that you will have to adjust your file path if you installed
Guix in another location. We have to use <code>exec</code> so that the shell gets replaced
by the daemon instead of running the daemon inside the shell.</p><p>All that remains now is to test, enable and finally run the Guix daemon
service.</p></article></main><nav class="blog-pager"><a href="../../../../2020/11/15/my-computer-broke-down/" rel="previous" style="float: left"><span aria-hidden="true">←</span> My computer broke down</a><a href="../../../../2020/12/27/making-bash-xdg-compliant/" rel="next" style="float: right">Making Bash compliant with the XDG Base Directory specification <span aria-hidden="true">→</span></a></nav><nav class="blog-navigation" aria-label="Blog navigation"><aside><span>Subscribe:</span> <a href="/blog//rss.xml" type="application/rss+xml">RSS</a></aside><nav><h1><a href="/blog/archive/">Archive</a></h1><ul><li><a href="/blog/2020/">2020 (15)</a></li><li><a href="/blog/2019/">2019 (17)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">Categories</a></h1><ul><li><a href="/blog/categories/vim/">vim (11)</a></li><li><a href="/blog/categories/misc/">misc (11)</a></li><li><a href="/blog/categories/organisation/">organisation (11)</a></li><li><a href="/blog/categories/open-source/">open-source (12)</a></li></ul></nav><nav><h1><a href="/blog/tags/">Tags</a></h1><ul><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/msgpack/">msgpack (3)</a></li><li><a href="/blog/tags/awk/">awk (1)</a></li><li><a href="/blog/tags/vim/">vim (12)</a></li><li><a href="/blog/tags/html/">html (8)</a></li><li><a href="/blog/tags/rant/">rant (4)</a></li><li><a href="/blog/tags/linux/">linux (1)</a></li><li><a href="/blog/tags/guix/">guix (1)</a></li><li><a href="/blog/tags/lisp/">lisp (14)</a></li><li><a href="/blog/tags/unix/">unix (8)</a></li><li><a href="/blog/tags/lua/">lua (2)</a></li></ul></nav></nav></div></div><footer><div><div class="footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" height="55" /></a><p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License" /> </a>© 2015-2021, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="footer-social"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img src="/img/footer/github.png" alt="GitHub" height="55" /> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img src="/img/footer/gitlab.png" alt="GitLab" height="55" /> </a></div></div></footer></body></html>
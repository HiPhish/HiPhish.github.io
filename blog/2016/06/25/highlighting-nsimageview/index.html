

<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>
			HiPhish's Workshop
		</title>
		
		<!-- Bootstrap integration -->
		<link rel="stylesheet"
		href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css"
		crossorigin="anonymous"/>

		<!-- Bootstrap customisation -->
		<link rel="stylesheet" href="/theme/css/custom.css" type="text/css" media="all"/>

		<!-- My own style sheets -->
		<link rel="stylesheet" href="/theme/css/local-nav.css" type="text/css" media="all"/>
		<link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" media="all"/>
<link rel="stylesheet" href="/theme/css/blog.css" type="text/css" media="all">
	
<link rel="stylesheet" href="/theme/css/article.css" type="text/css" media="all">

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

		<!-- Bootstrap Javascript -->
		<script
			src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
			integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
		crossorigin="anonymous"></script>
	</head>
	<body>
		<h1>HTML-page body</h1>
		<header>
			<!-- Top navigation bar -->
			<nav id="main-navbar" class="navbar navbar-default">
				<h1>Site-wide navigation bar</h1>
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="container-fluid">
					<input type="checkbox" value="" name="navbar-toggle-cbox" id="navbar-toggle-cbox"/>
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
						<label for="navbar-toggle-cbox" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-controls="navbar-toggle-cbox">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</label>
						<a class="navbar-brand" href="http://hiphish.github.io">HiPhish's Workshop</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="main-navbar-collapse">
						<!-- The list of navbar items -->
						<ul class="nav navbar-nav">
							<li class="dropdown">
								<a class="dropdown-toggle" href="/grid-framework" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Grid Framework <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="http://hiphish.github.io/grid-framework">
											Overview										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/features">
											Features										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/examples">
											Examples										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/gallery">
											Gallery										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/showcase">
											Showcase										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/faq">
											FAQ										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/news">
											News										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/" target="_blank">
											Support										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="https://www.assetstore.unity3d.com/#/content/62498" target="_blank">
											Buy Now <span class="badge">35$</span>										</a>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a class="dropdown-toggle" href="https://gitlab.com/HiPhish/ntfs-clone" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Open Source <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="https://gitlab.com/HiPhish/ntfs-clone" target="_blank">
											NTFS-Clone										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/roll" target="_blank">
											roll										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Newton-method" target="_blank">
											Newton's Method in C										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/XeenTools" target="_blank">
											Xeen Tools										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Wolf3DExtract" target="_blank">
											Wolf3D Extract										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Game-Source-Documentation" target="_blank">
											Game Source Documentation										</a>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a class="dropdown-toggle" href="https://gitlab.com/HiPhish/info.vim" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Nvim/Vim Plugins <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="https://gitlab.com/HiPhish/info.vim" target="_blank">
											Info.vim										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/repl.nvim" target="_blank">
											REPL.nvim										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/jinja.vim" target="_blank">
											jinja.vim										</a>
									</li>
								</ul>
							</li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
								<li class=" ">
									<a href="/blog">
										Blog									</a>
								</li>
								<li class=" ">
									<a href="/about">
										About									</a>
								</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<section class="container">
			<h1>Document body</h1>


<section class="blog-body">
	<h1>Blog</h1>

	<!-- Article body -->
	<section>
<main>
	<nav class="blog-breadcrumbs" aria-label="Breadcrumbs">
	<h1>Breadcrumbs navigation</h1>
	<ol class="breadcrumb">
		<li>
			<a href="http://hiphish.github.io/blog/">
				blog
			</a>
		</li>
		<li>
			<a href="http://hiphish.github.io/blog/2016/">
				2016
			</a>
		<li>
			<a href="http://hiphish.github.io/blog/2016/06/">
				06
			</a>
		<li class="active">
			25
		</li>
		<li class="active">
			highlighting-nsimageview
		</li>
	</ol>
</nav>


	<article>
		<!-- Title of the article -->
		<h1>
			<a href="http://hiphish.github.io/blog/2016/06/25/highlighting-nsimageview/" rel="bookmark" title="Permalink to Highlighting NSImageView the right way">
				Highlighting <cite>NSImageView</cite> the right way
			</a>
		</h1>

		<header>
<!-- Date of the article -->
			<p>
				<time class="published" datetime="2016-06-25T00:00:00+02:00">
					Published: 2016-06-25
				</time>
			</p>

			<!-- TODO: This has to be something nicer than a button -->
			<p>
				Category:
				<a class="" href="http://hiphish.github.io/blog/categories/misc/">
					misc
				</a>
			</p>

			<!-- TODO: This has to be something nicer than a button -->
			<p>
				Tags:
				<a class="" href="http://hiphish.github.io/blog/tags/cocoa/">
					cocoa
				</a>
			</p>
		</header>

		<!-- Content of the article -->
		<p>Recently  I have  been working on  a small Cocoa  app and one  of the  things I
needed to do was highlight an  <code>NSImageView</code> when the user is hovering above it
while dragging a file.  You would think  that it's a very simple task,  and you
would be right, but judging by some of the things on the internet it looks like
an unsolved problem.</p>
<p>The difficult part about Mac development is not Objective-C, if you know C then
you can learn  Objective-C in a  few days.  The hard part is Cocoa.  Cocoa is a
very old framework,  older than .NET, Java and macOS.  A framework  this old is
guaranteed to have grown a lot  over the years and finding what you are looking
for can  be a  daunting task.  Even Apple's  own documentation  is filled  with
deprecated API calls or downright bad practice.</p>
<div class="section" id="the-wrong-way">
<h2>The wrong way</h2>
<p>Here is how Apple's own documentation highlights an <code>NSImageView</code> instance. The
code is from the official <a class="reference external" href="https://developer.apple.com/library/mac/samplecode/CocoaDragAndDrop/Introduction/Intro.html">CocoaDragAndDrop</a> example.</p>
<div class="highlight"><pre><span></span><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span><span class="nv">rect</span>
<span class="p">{</span>
    <span class="cm">/*------------------------------------------------------</span>
<span class="cm">        draw method is overridden to do drop highlighing</span>
<span class="cm">    --------------------------------------------------------*/</span>
    <span class="c1">//do the usual draw operation to display the image</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">drawRect</span><span class="p">:</span><span class="n">rect</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">highlight</span> <span class="p">)</span> <span class="p">{</span>
        <span class="c1">//highlight by overlaying a gray border</span>
        <span class="p">[[</span><span class="n">NSColor</span> <span class="n">grayColor</span><span class="p">]</span> <span class="n">set</span><span class="p">];</span>
        <span class="p">[</span><span class="n">NSBezierPath</span> <span class="nl">setDefaultLineWidth</span><span class="p">:</span> <span class="mi">5</span><span class="p">];</span>
        <span class="p">[</span><span class="n">NSBezierPath</span> <span class="nl">strokeRect</span><span class="p">:</span> <span class="n">rect</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>There are other  implementations on the internet,  but those can be excused for
not being official. They all have the same fundamental problem anyway,  so I'll
just use this one for illustration.</p>
<p>The implementation  looks simple  enough and works,  but only  as long  as your
<code>NSImageView</code> instance satisfies the assumptions made here.  We assume that our
view object will always have  the outline of a rectangle and we assume that the
chosen colour  will always  be adequate.  In my  case the first  assumption was
already broken from the start because I was using the <em>Bezel</em> style for my view
objects, a style that is part of Cocoa itself. There is also no telling when in
the future Apple might change the default colours, making your choice of colour
inadequate. And that's not even going into portability if you want to use
GNUStep to port your app to other operating systems.</p>
<p>What we want is an abstraction.  Abstractions provide us with a clean interface
that can remain stable while  the underlying implementation  can change wildly.
Cocoa has abstractions everywhere, such as using <code>NSURL</code> for file paths instead
of C  strings  or even <code>NSString</code>.  Doing things  your own  way should  only be
reserved for when  you actually have control over the underlying code.  So if I
were  to  draw my  own  shapes  for an  <code>NSView</code> I  would  also  be comfortable
hard-coding my own highlighting.</p>
</div>
<div class="section" id="the-right-way">
<h2>The right way™</h2>
<p>As it turns out  Cocoa already provides  us with the  means of abstraction  for
highlighting.  The <code>NSControl</code> class has the <code>highlighted</code> property,  which has
the getter <code>isHighlighted</code>,  so we don't need  a new property.  For drawing the
actual highlight <code>NSView</code>  provides the method <code>drawFocusRingMask</code>.  Subclasses
can override  the property  to implement  their own  highlighting  and  luckily
<code>NSImageView</code> does exacly that.</p>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span><span class="nv">dirtyRect</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">drawRect</span><span class="p">:</span><span class="n">dirtyRect</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="nb">self</span> <span class="n">isHighlighted</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="nb">self</span> <span class="n">drawFocusRingMask</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Now your code is future-proof and will work regardless of the shape you choose.
Well, at least until Apple deprecates this method.</p>
</div>

	</article>

	<footer>
		<!-- Navigation items (next/previous) -->
		<nav>
			<h1>Previous/next article</h1>
			<ul class="pager">
				<li class="previous">
					<a href="http://hiphish.github.io/blog/2016/05/31/into-ntfs-clone/" rel="prev">
						<span aria-hidden="true">&larr;</span> Introducing NTFS-Clone
					</a>
				</li>
				<li class="next">
					<a href="http://hiphish.github.io/blog/2016/07/06/intro-ips-tools/" rel="next">
						Introducing IPS-Tools <span aria-hidden="true">&rarr;</span>
					</a>
				</li>
			</ul>
		</nav>
	</footer>
</main>
	</section>

	<!-- "Left" pillar, article navigation -->
	<nav class="well">
		<!-- This navigator contains links to the various archive types. -->
		<h1>Blog navigation</h1>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/archives/">
					Archives
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/2017/">
						2017 (2)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/2016/">
						2016 (6)
					</a>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/11/">
								November (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/09/">
								September (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/07/">
								July (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/06/">
								June (1)
							</a>
							<ul>
								<li>
									<a href="http://hiphish.github.io/blog/2016/06/25/highlighting-nsimageview/">
										Highlighting <cite>NSImageView</cite> the right way
									</a>
								</li>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/05/">
								May (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2016/04/">
								April (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/2015/">
						2015 (2)
					</a>
				</li>
			</ul>
		</nav>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/categories/">
					Categories
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/categories/ips-tools/">
						ips-tools (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/misc/">
						misc (3)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/ntfs-clone/">
						ntfs-clone (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/open-source/">
						Open-Source (2)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/organisation/">
						organisation (3)
					</a>
				</li>
			</ul>
		</nav>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/tags/">
					Tags
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/tags/info/">
						info (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/website/">
						website (3)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/outline/">
						outline (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/vim/">
						vim (3)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/cocoa/">
						cocoa (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/rant/">
						rant (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/html/">
						html (1)
					</a>
				</li>
			</ul>
		</nav>

		<aside>
			<h1>Subscription options</h1>
			<strong>
				Subscribe:
				<a href="http://hiphish.github.io/blog/rss.xml">RSS</a>
				<a href="http://hiphish.github.io/blog/atom.xml">Atom</a>
			</strong>
		</aside>
	</nav>
</section>
		</section>

		<!-- Footer of the website -->
		<footer>
			<div class="container">
				<div class="col-md-8 footer-self">
					<a href="http://192.168.0.190:8000" title="HiPhish's Workshop">
						<img src="http://hiphish.github.io/images/footer/logo.png" alt="HiPhish's Workshop" />
					</a>
					<p class="text-muted">
						<a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" alt="Creative Commons Attribution-ShareAlike 4.0International License" src="http://hiphish.github.io/images/footer/cc.svg" /></a>
						© 2015-2017, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
					</p>
				</div>  <!-- /.col-md-8 -->

				<div class="col-md-4 footer-social">
					<span class="pull-right">
						<a href="https://github.com/HiPhish" title="GitHub" target="_blank">
							<img  class="img-circle" src="http://hiphish.github.io/images/footer/github.png" alt="GitHub"/>
						</a>
						<a href="https://gitlab.com/u/HiPhish" title="GitLab" target="_blank">
							<img  class="img-circle" src="http://hiphish.github.io/images/footer/gitlab.png" alt="GitLab"/>
						</a>
					</span>  <!-- /.pull-right -->
				</div>  <!-- /.col-md-4 -->
			</div>
		</footer>
	</body>
</html>


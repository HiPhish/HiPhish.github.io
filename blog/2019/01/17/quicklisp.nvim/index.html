<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>HiPhish's Workshop</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" crossorigin="anonymous" /><link rel="stylesheet" href="/css/main.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/pygments.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/article.css" type="text/css" media="all" /></head><body><header><nav id="main-navbar"><input type="checkbox" id="main-nav-hamburger" hidden="hidden" /><div><a href="/">HiPhish's Workshop</a><label for="main-nav-hamburger" hidden="hidden"></label></div><ul><li><a href="/grid-framework/">Grid Framework</a><ul><li><a href="/grid-framework/">Overview</a></li><li hidden="hidden"></li><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href="/grid-framework/news/">News</a></li><li hidden="hidden"></li><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li hidden="hidden"></li><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li><a href="/#products">Open Source</a><ul><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li><a href="/#products">Vim/Nvim plugins</a><ul><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li><li><a href="https://gitlab.com/HiPhish/neovim-guix-channel/">Guix channel</a></li></ul></li><li class="push-end"><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></nav></header><div><div class="blog"><nav class="breadcrumbs" aria-label="Breadcrumbs"><ol><li class=""><a href="../../../..">blog</a></li><li class=""><a href="../../..">2019</a></li><li class=""><a href="../..">01</a></li><li class="active">17</li><li class="active">quicklisp.nvim</li></ol></nav><main><article><h1><a href="." title="Permalink to Introducing Quicklisp.nvim" rel="bookmark">Introducing Quicklisp.nvim</a></h1><header><p><time class="published" datetime="2019-01-17">Published: 2019-01-17</time></p><p>Category: <a href="../../../../categories/vim/">vim</a></p><p>Tags: <a href="../../../../tags/lisp/">lisp </a><a href="../../../../tags/vim/">vim </a></p></header><p>One of the new features of <a href="https://neovim.io/">Neovim</a> is its ability to write plugins in any
programming language, provided that there is a plugin host available. I have
wanted to play around with the <a href="https://github.com/adolenc/cl-neovim/">Common Lisp host</a> for a while, and I like for
something useful to come out of it in the end, so I created <a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a>, a
plugin which allows users to manage Common Lisp libraries from inside Neovim.</p><h2>Overview</h2><p>Everything is explained in detail in the included documentation, so I will only
provide a broad overview of the functionality. The one command provided is
appropriately named <code>:Quicklisp</code>. It takes one mandatory argument, which is the
sub-command to perform, followed by arguments to that sub-command if necessary.</p><p>Let's say we want to install a library. In Quicklisp we would type out
<code>(ql:quickload &quot;cl-ppcre&quot;)</code> in the Lisp REPL. In Neovim we would then execute
the command <code>:Quicklisp quickload cl-ppcre</code> and the result would be printed in
the message area.</p><pre><code>┌────────────────────────────────────────────────┐
│;; Contents of buffer...                        │
│~                                               │
│~                                               │
│~                                               │
│━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
│To load &quot;cl-ppcre&quot;:                             │
│  Load 1 ASDF system:                           │
│    cl-ppcre                                    │
│; Loading &quot;cl-ppcre&quot;                            │
│                                                │
│Press ENTER or type command to continue         │
└────────────────────────────────────────────────┘</code></pre><p>All the other sub-commands also follow the same rules as in Quicklisp, so if
you know how to use Quicklisp you also know how to use Quicklisp.nvim.</p><h2>How it works</h2><p>I have already hinted in the opening paragraph at the fact that Quicklisp.nvim
is entirely written in Common Lisp. Unlike most package managers, Quicklisp
does not have a command-line interface, users are expected to call the
Quicklisp functions from the Lisp REPL. This also means that it is possible to
use Quicklisp as a Lisp library.</p><p>Let use look at the <code>quickload</code> function as an example.</p><pre><code class="language-lisp">(defun quickload (system-names)
  (declare (type list system-names))
  &quot;Quick-loads systems from the list SYSTEM-NAMES, echo output in Neovim.&quot;
  (dolist (system-name system-names)
    (declare (type string system-name))
    (nvim:out-write
      (format nil &quot;~A~&amp;&quot;
              (with-output-to-string (*standard-output*)
                (with-output-to-string (*error-output*)
                  (ql:quickload system-name)))))))</code></pre><p>This is the code that gets actually executed when the user executes <code>:Quicklisp quickload</code>. Most of the code is just using the Neovim API to redirect the
output of Quicklisp back to Neovim instead of writing to the terminal.</p><p>This function also exposes some deficiencies in Quicklisp and Neovim. Quicklisp
lacks an official API, I had to dig through the source code to find out what is
possible and what is not. It would have been nicer if there was a documented
back-end API for people who want to build their own tools on top of Quicklisp.</p><p>As for Neovim, the <code>out-write</code> API method of Neovim cannot stream text. Instead
I have to wait until <code>ql:quickload</code> terminates. If the user executes a command
that takes a while to finish, it will look like the editor is frozen, and then
all the output will be vomited on screen at once. The usual solution is to
create a read-only buffer and stream the text into the buffer instead. I could
have done that, but I wanted to just get this plugin out of the door. Adding a
buffer-based interface can be done at any time without much refactoring.</p><p>Other than that, it was a very pleasant experience to write a Neovim plugin in
Lisp. Thanks to the API I did not feel any &quot;vimisms&quot; while writing, everything
was very well integrated in the Lisp way.</p></article></main><nav class="blog-pager"><a href="../../../../2019/01/15/a-new-ssg/" rel="previous" style="float: left"><span aria-hidden="true">←</span> A new static site generator</a><a href="../../../../2019/01/21/neovim-guix-channel/" rel="next" style="float: right">Neovim channel for GNU Guix <span aria-hidden="true">→</span></a></nav><nav class="blog-navigation" aria-label="Blog navigation"><aside><span>Subscribe:</span> <a href="/blog/rss.xml" type="application/rss+xml">RSS</a></aside><nav><h1><a href="/blog/archive/">Archive</a></h1><ul><li><a href="/blog/2019/">2019 (8)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">Categories</a></h1><ul><li><a href="/blog/categories/misc/">misc (4)</a></li><li><a href="/blog/categories/vim/">vim (5)</a></li><li><a href="/blog/categories/organisation/">organisation (7)</a></li><li><a href="/blog/categories/open-source/">open-source (5)</a></li></ul></nav><nav><h1><a href="/blog/tags/">Tags</a></h1><ul><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/rant/">rant (1)</a></li><li><a href="/blog/tags/vim/">vim (5)</a></li><li><a href="/blog/tags/html/">html (5)</a></li><li><a href="/blog/tags/lisp/">lisp (7)</a></li><li><a href="/blog/tags/msgpack/">msgpack (3)</a></li></ul></nav></nav></div></div><footer><div><div class="footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" /></a><p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License" /> </a>© 2015-2019, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="footer-social"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img src="/img/footer/github.png" alt="GitHub" /> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img src="/img/footer/gitlab.png" alt="GitLab" /> </a></div></div></footer></body></html>
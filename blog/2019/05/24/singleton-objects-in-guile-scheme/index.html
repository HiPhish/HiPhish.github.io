<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>HiPhish's Workshop</title><link rel="stylesheet" href="/css/main.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all" /></head><body><header><nav id="main-navbar"><input type="checkbox" id="main-nav-hamburger" hidden="hidden" /><div><a href="/">HiPhish's Workshop</a><label for="main-nav-hamburger" hidden="hidden"></label></div><ul><li><a href="/grid-framework/">Grid Framework</a><ul><li><a href="/grid-framework/">Overview</a></li><li hidden="hidden"></li><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href="/grid-framework/news/">News</a></li><li hidden="hidden"></li><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li hidden="hidden"></li><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li><a href="/#products">Open Source</a><ul><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/IPS-Tools">IPS-Tools</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li><a href="/vim/plugins/">Vim/Nvim plugins</a><ul><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li><li><a href="https://gitlab.com/HiPhish/neovim-guix-channel/">Guix channel</a></li></ul></li><li class="push-end"><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></nav></header><div><div class="blog"><nav class="breadcrumbs" aria-label="Breadcrumbs"><ol><li class=""><a href="../../../..">blog</a></li><li class=""><a href="../../..">2019</a></li><li class=""><a href="../..">05</a></li><li class="active">24</li><li class="active">singleton-objects-in-guile-scheme</li></ol></nav><main class="blogpost"><article><h1><a href="." title="Permalink to Singleton objects in Guile Scheme" rel="bookmark">Singleton objects in Guile Scheme</a></h1><header><p><time class="published" datetime="2019-05-24">Published: 2019-05-24</time></p><p>Category: <a href="../../../../categories/misc/">misc</a></p><p>Tags: <a href="../../../../tags/lisp/">lisp </a></p></header><p>When I wrote <a href="https://gitlab.com/HiPhish/guile-msgpack">guile-messagepack</a> I needed an object to represent the <code>nil</code>
value, which embodies the concept of &quot;nothingness&quot; or &quot;no value&quot; in
<a href="https://msgpack.org/">MessagePack</a>. None of the existing objects like <code>#f</code> or <code>'()</code> were adequate,
so I decided to make a new one: <code>nothing</code>. It does not make sense for there to
be multiple instance of <code>nothing</code>, so it had to be a singleton. In this blog
post I will describe a way of creating such a singleton.</p><p>We first define a new record type <code>&lt;nothing&gt;</code> which has no fields. The record
type has a custom printing procedure which displays a nice-looking
representation.</p><pre><code class="language-scheme">(define &lt;nothing&gt;
  (make-record-type &quot;&lt;nothing&gt;&quot; '() (λ (rec out) (display &quot;#&lt;nothing&gt;&quot; out))))</code></pre><p>This simply returns a <em>record type descriptor</em>, which means that we have told
Guile that such a record type exists and how many slots it has, but Guile has
not defined any constructor or accessors for us. This does not mean that there
is no constructor procedure, it only means that the constructor is not bound to
any variable. It can still be accessed by using the <code>record-constructor</code>
procedure and our <code>&lt;nothing&gt;</code> record descriptor. We will use this to define our
own constructor.</p><pre><code class="language-scheme">(define nothing
  (let ((the-nothing ((record-constructor &lt;nothing&gt;))))
    (λ ()
      &quot;- Scheme Procedure: nothing
     Returns the singleton instance of the MessagePack nothingness object.&quot;
      the-nothing)))</code></pre><p>Here we are using the <em>let-over-λ</em> technique: we bind one freshly created
instance of the <code>&lt;nothing&gt;</code> record to <code>the-nothing</code> and return a procedure
which always returns this one instance. Thus each call to <code>nothing</code> returns the
same instance:</p><pre><code class="language-scheme">;; This always evaluates to #t
(eq? (nothing)
     (nothing))</code></pre><p>Since the results are all <code>eq?</code> we can also define a predicate which uses this
fast equality check to verify whether an object is the nothingness object.</p><pre><code class="language-scheme">(define (nothing? object)
  &quot;- Scheme Procedure: nothing? object
     Return `#t' if OBJECT is 'eq?' to the MessagePack nothingness object,
     else return `#f'.&quot;
  (eq? object (nothing)))</code></pre><p>The user-facing interface consists only of the constructor and the predicate.
The constructor allows us to create new nothingness for packing with
MessagePack and the predicate allows us to decide whether an object unpacked
from MessagePack is a nothingness object.</p><pre><code class="language-scheme">(define-module (msgpack nothing)
  #:export (nothing nothing?))</code></pre></article></main><nav class="blog-pager"><a href="../../../../2019/05/10/writing-ncm2-sources/" rel="previous" style="float: left"><span aria-hidden="true">←</span> Writing NCM2 sources</a><a href="../../../../2019/06/07/introducing-awk-ward-nvim/" rel="next" style="float: right">Introducing Awk-ward.nvim <span aria-hidden="true">→</span></a></nav><nav class="blog-navigation" aria-label="Blog navigation"><aside><span>Subscribe:</span> <a href="/blog//rss.xml" type="application/rss+xml">RSS</a></aside><nav><h1><a href="/blog/archive/">Archive</a></h1><ul><li><a href="/blog/2020/">2020 (8)</a></li><li><a href="/blog/2019/">2019 (17)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">Categories</a></h1><ul><li><a href="/blog/categories/vim/">vim (11)</a></li><li><a href="/blog/categories/open-source/">open-source (7)</a></li><li><a href="/blog/categories/misc/">misc (11)</a></li><li><a href="/blog/categories/organisation/">organisation (9)</a></li></ul></nav><nav><h1><a href="/blog/tags/">Tags</a></h1><ul><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/msgpack/">msgpack (3)</a></li><li><a href="/blog/tags/awk/">awk (1)</a></li><li><a href="/blog/tags/vim/">vim (12)</a></li><li><a href="/blog/tags/rant/">rant (3)</a></li><li><a href="/blog/tags/unix/">unix (4)</a></li><li><a href="/blog/tags/html/">html (7)</a></li><li><a href="/blog/tags/lisp/">lisp (12)</a></li></ul></nav></nav></div></div><footer><div><div class="footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" height="55" /></a><p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License" /> </a>© 2015-2020, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="footer-social"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img src="/img/footer/github.png" alt="GitHub" height="55" /> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img src="/img/footer/gitlab.png" alt="GitLab" height="55" /> </a></div></div></footer></body></html>
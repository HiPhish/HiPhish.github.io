

<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>
			HiPhish's Workshop
		</title>
		
		<!-- Bootstrap integration -->
		<link rel="stylesheet"
		href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css"
		crossorigin="anonymous"/>

		<!-- Bootstrap customisation -->
		<link rel="stylesheet" href="/theme/css/custom.css" type="text/css" media="all"/>

		<!-- My own style sheets -->
		<link rel="stylesheet" href="/theme/css/local-nav.css" type="text/css" media="all"/>
		<link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" media="all"/>
<link rel="stylesheet" href="/theme/css/blog.css" type="text/css" media="all">
	
<link rel="stylesheet" href="/theme/css/article.css" type="text/css" media="all">

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

		<!-- Bootstrap Javascript -->
		<script
			src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
			integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
		crossorigin="anonymous"></script>
	</head>
	<body>
		<h1>HTML-page body</h1>
		<header>
			<!-- Top navigation bar -->
			<nav id="main-navbar" class="navbar navbar-default">
				<h1>Site-wide navigation bar</h1>
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="container-fluid">
					<input type="checkbox" value="" name="navbar-toggle-cbox" id="navbar-toggle-cbox"/>
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
						<label for="navbar-toggle-cbox" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-controls="navbar-toggle-cbox">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</label>
						<a class="navbar-brand" href="http://hiphish.github.io">HiPhish's Workshop</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="main-navbar-collapse">
						<!-- The list of navbar items -->
						<ul class="nav navbar-nav">
							<li class="dropdown">
								<a class="dropdown-toggle" href="/grid-framework" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Grid Framework <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="http://hiphish.github.io/grid-framework">
											Overview										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/features">
											Features										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/examples">
											Examples										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/gallery">
											Gallery										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/showcase">
											Showcase										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/faq">
											FAQ										</a>
									</li>

									<li>
										<a href="http://hiphish.github.io/grid-framework/news">
											News										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/" target="_blank">
											Support										</a>
									</li>

									<li class="divider" role="separator"></li>

									<li>
										<a href="https://www.assetstore.unity3d.com/#/content/62498" target="_blank">
											Buy Now <span class="badge">35$</span>										</a>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a class="dropdown-toggle" href="https://gitlab.com/HiPhish/ntfs-clone" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Open Source <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="https://gitlab.com/HiPhish/ntfs-clone" target="_blank">
											NTFS-Clone										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/roll" target="_blank">
											roll										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Newton-method" target="_blank">
											Newton's Method in C										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/XeenTools" target="_blank">
											Xeen Tools										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Wolf3DExtract" target="_blank">
											Wolf3D Extract										</a>
									</li>

									<li>
										<a href="https://github.com/HiPhish/Game-Source-Documentation" target="_blank">
											Game Source Documentation										</a>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a class="dropdown-toggle" href="https://gitlab.com/HiPhish/info.vim" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
									Nvim/Vim Plugins <span></span>								</a>
								<ul class="dropdown-menu">

									<li>
										<a href="https://gitlab.com/HiPhish/info.vim" target="_blank">
											Info.vim										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/repl.nvim" target="_blank">
											REPL.nvim										</a>
									</li>

									<li>
										<a href="https://gitlab.com/HiPhish/jinja.vim" target="_blank">
											jinja.vim										</a>
									</li>
								</ul>
							</li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
								<li class=" ">
									<a href="/blog">
										Blog									</a>
								</li>
								<li class=" ">
									<a href="/about">
										About									</a>
								</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<section class="container">
			<h1>Document body</h1>


<section class="blog-body">
	<h1>Blog</h1>

	<!-- Article body -->
	<section>
<main>
	<nav class="blog-breadcrumbs" aria-label="Breadcrumbs">
	<h1>Breadcrumbs navigation</h1>
	<ol class="breadcrumb">
		<li>
			<a href="http://hiphish.github.io/blog/">
				blog
			</a>
		</li>
		<li>
			<a href="http://hiphish.github.io/blog/2017/">
				2017
			</a>
		<li>
			<a href="http://hiphish.github.io/blog/2017/05/">
				05
			</a>
		<li class="active">
			13
		</li>
		<li class="active">
			mock-repl-unix
		</li>
	</ol>
</nav>


	<article>
		<!-- Title of the article -->
		<h1>
			<a href="http://hiphish.github.io/blog/2017/05/13/mock-repl-unix/" rel="bookmark" title="Permalink to Creating a mock REPL on Unix">
				Creating a mock REPL on Unix
			</a>
		</h1>

		<header>
<!-- Date of the article -->
			<p>
				<time class="published" datetime="2017-05-13T00:00:00+02:00">
					Published: 2017-05-13
				</time>
			</p>

			<!-- TODO: This has to be something nicer than a button -->
			<p>
				Category:
				<a class="" href="http://hiphish.github.io/blog/categories/misc/">
					misc
				</a>
			</p>
		</header>

		<!-- Content of the article -->
		<p>During the development of <a class="reference external" href="https://gitlab.com/HiPhish/repl.nvim/">REPL.nvim</a> I had to be able to test the plugin
without relying on any particular REPL present on the development system. The
solution was to create a mock REPL, a shell script which acts like a really
dumb REPL. Here is the code:</p>
<div class="highlight"><pre><span></span><span class="nv">EOF</span><span class="o">=</span><span class="nb">false</span>

<span class="nb">echo</span> <span class="s1">'This is a dummy REPL, it does nothing and comes with no warranty.'</span>
<span class="k">until</span> <span class="nv">$EOF</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nb">printf</span> <span class="s1">'&gt;&gt;&gt; '</span>
        <span class="nb">read</span> -r <span class="o">||</span> <span class="nv">EOF</span><span class="o">=</span><span class="s1">'true'</span>
        <span class="k">if</span> <span class="o">[</span> ! <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="k">continue</span><span class="p">;</span> <span class="k">fi</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span>
<span class="k">done</span>
<span class="c1"># Terminating new line if there was no reply</span>
<span class="k">if</span> <span class="o">[</span> ! <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s1">''</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
<p>The first line is a simple state variable which will be set to <code>true</code> once the
user presses <code>^D</code>. As long as the variable remains <code>false</code> the loop will keep
running.</p>
<p>Next comes the actual <em>Loop</em> part of the REPL; it prints a prompt and then
reads a line indefinitely. The <em>Read</em> part is implemented using the built-in
<code>read</code> to store the result in the implicit variable <code>$REPLY</code>. Should <code>read</code>
read <code>^D</code> the exist code will be non-zero, causing the conditional <code>||</code> to set
the <code>EOF</code> variable to <code>true</code>. This is our exit mechanism out of the REPL. There
is no <em>Evaluate</em> part since this is a mock REPL (or you could say that any
input evaluates to itself). Finally the <em>Print</em> part is implemented by using
<code>echo</code> to echo back the input.</p>
<p>Technically the REPL could also be implemented with less code:</p>
<div class="highlight"><pre><span></span><span class="nv">EOF</span><span class="o">=</span><span class="nb">false</span>
<span class="k">until</span> <span class="nv">$EOF</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nb">printf</span> <span class="s1">'&gt;&gt;&gt; '</span>
        <span class="nb">read</span> -r <span class="o">||</span> <span class="nv">EOF</span><span class="o">=</span><span class="s1">'true'</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
<p>The additional code is just to give the REPL some extra polish. It's not really
needed if no human will never use it, but I like the extra touch. The first
line</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> ! <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="k">continue</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
<p>prevents the loop from reaching the <code>echo</code> if <code>$REPLY</code> is an empty string.
Without it if the user does not enter any text an empty line would be printed:</p>
<pre class="code literal-block">
# Without extra touch
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt;

&gt;&gt;&gt; bar
bar

# With textra touch
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt;
&gt;&gt;&gt; bar
bar
</pre>
<p>The other line</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> ! <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s1">''</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
<p>causes <code>echo</code> to display an empty string. This empty string will move the shell
prompt onto the next line:</p>
<pre class="code literal-block">
# Without extra polish
sh-3.2$ sh mock-repl.sh
This is a dummy REPL, it does nothing and comes with no warranty.
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt; sh-3.2$

# With extra polish
sh-3.2$ sh mock-repl.sh
This is a dummy REPL, it does nothing and comes with no warranty.
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt; ^D
sh-3.2$
</pre>
<p>The mock REPL can then be invoked like any other shell script and be used in
place of a real REPL program when testing. That way we do not have to be wary
of any side effects and the developer does not need to have any particular
program installed on their system.</p>

	</article>

	<footer>
		<!-- Navigation items (next/previous) -->
		<nav>
			<h1>Previous/next article</h1>
			<ul class="pager">
				<li class="previous">
					<a href="http://hiphish.github.io/blog/2017/05/06/introducing-repl-nvim/" rel="prev">
						<span aria-hidden="true">&larr;</span> Introducing REPL.nvim
					</a>
				</li>
			</ul>
		</nav>
	</footer>
</main>
	</section>

	<!-- "Left" pillar, article navigation -->
	<nav class="well">
		<!-- This navigator contains links to the various archive types. -->
		<h1>Blog navigation</h1>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/archives/">
					Archives
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/2017/">
						2017 (3)
					</a>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2017/05/">
								May (2)
							</a>
							<ul>
								<li>
									<a href="http://hiphish.github.io/blog/2017/05/13/mock-repl-unix/">
										Creating a mock REPL on Unix
									</a>
								</li>
								<li>
									<a href="http://hiphish.github.io/blog/2017/05/06/introducing-repl-nvim/">
										Introducing REPL.nvim
									</a>
								</li>
							</ul>
						</li>
					</ul>
					<ul>
						<li>
							<a href="http://hiphish.github.io/blog/2017/04/">
								April (1)
							</a>
							<ul>
							</ul>
						</li>
					</ul>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/2016/">
						2016 (6)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/2015/">
						2015 (2)
					</a>
				</li>
			</ul>
		</nav>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/categories/">
					Categories
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/categories/ips-tools/">
						ips-tools (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/misc/">
						misc (4)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/ntfs-clone/">
						ntfs-clone (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/open-source/">
						Open-Source (2)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/categories/organisation/">
						organisation (3)
					</a>
				</li>
			</ul>
		</nav>

		<nav>
			<h1>
				<a href="http://hiphish.github.io/blog/tags/">
					Tags
				</a>
			</h1>
			<ul>
				<li>
					<a href="http://hiphish.github.io/blog/tags/info/">
						info (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/website/">
						website (3)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/outline/">
						outline (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/vim/">
						vim (3)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/cocoa/">
						cocoa (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/rant/">
						rant (1)
					</a>
				</li>
				<li>
					<a href="http://hiphish.github.io/blog/tags/html/">
						html (1)
					</a>
				</li>
			</ul>
		</nav>

		<aside>
			<h1>Subscription options</h1>
			<strong>
				Subscribe:
				<a href="http://hiphish.github.io/blog/rss.xml">RSS</a>
				<a href="http://hiphish.github.io/blog/atom.xml">Atom</a>
			</strong>
		</aside>
	</nav>
</section>
		</section>

		<!-- Footer of the website -->
		<footer>
			<div class="container">
				<div class="col-md-8 footer-self">
					<a href="http://192.168.0.190:8000" title="HiPhish's Workshop">
						<img src="http://hiphish.github.io/images/footer/logo.png" alt="HiPhish's Workshop" />
					</a>
					<p class="text-muted">
						<a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" alt="Creative Commons Attribution-ShareAlike 4.0International License" src="http://hiphish.github.io/images/footer/cc.svg" /></a>
						Â© 2015-2017, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
					</p>
				</div>  <!-- /.col-md-8 -->

				<div class="col-md-4 footer-social">
					<span class="pull-right">
						<a href="https://github.com/HiPhish" title="GitHub" target="_blank">
							<img  class="img-circle" src="http://hiphish.github.io/images/footer/github.png" alt="GitHub"/>
						</a>
						<a href="https://gitlab.com/u/HiPhish" title="GitLab" target="_blank">
							<img  class="img-circle" src="http://hiphish.github.io/images/footer/gitlab.png" alt="GitLab"/>
						</a>
					</span>  <!-- /.pull-right -->
				</div>  <!-- /.col-md-4 -->
			</div>
		</footer>
	</body>
</html>


<html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>HiPhish's Workshop</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" crossorigin="anonymous" /><link rel="stylesheet" href="/css/custom.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/pygments.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all" /><link rel="stylesheet" href="/css/article.css" type="text/css" media="all" /><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script></head><body><h1>HTML-page body</h1><header><nav id="main-navbar" class="navbar navbar-default"><h1>Site-wide navigation bar</h1><div class="container-fluid"><input type="checkbox" value="" name="navbar-toggle-cbox" id="navbar-toggle-cbox" /><div class="navbar-header"><label for="navbar-toggle-cbox" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-controls="navbar-toggle-cbox"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></label><a class="navbar-brand" href="/">HiPhish's Workshop</a></div><div class="collapse navbar-collapse" id="main-navbar-collapse"><ul class="nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" href="/grid-framework/" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Grid Framework</a><ul class="dropdown-menu"><li><a href="/grid-framework/">Overview</a></li><li class="divider" role="separator"></li><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href="/grid-framework/news/">News</a></li><li class="divider" role="separator"></li><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li class="divider" role="separator"></li><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="/open-source/" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Open Source</a><ul class="dropdown-menu"><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="/vim/" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Vim/Nvim plugins</a><ul class="dropdown-menu"><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li></ul></li></ul><ul class="nav navbar-nav navbar-right"><li><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></div></div></nav></header><section class="container"><h1>Document body</h1><section class="col-md-12 container"><h1>Blog</h1><section><nav class="blog-breadcrumbs" aria-label="Breadcrumbs"><h1>Breadcrumbs navigation</h1><ol class="breadcrumb"><li class=""><a href="../../../..">blog</a></li><li class=""><a href="../../..">2017</a></li><li class=""><a href="../..">05</a></li><li class="active">13</li><li class="active">mock-repl-unix</li></ol></nav><main><article><h1><a href="." title="Permalink to Creating a mock REPL on Unix" rel="bookmark">Creating a mock REPL on Unix</a></h1><header><p><time class="published" datetime="2017-05-13">Published: 2017-05-13</time></p><p>Category: <a href="../../../../categories/misc/">misc</a></p></header><p>During the development of <a href="https://gitlab.com/HiPhish/repl.nvim/">REPL.nvim</a> I had to be able to test the plugin
without relying on any particular REPL present on the development system. The
solution was to create a mock REPL, a shell script which acts like a really
dumb REPL. Here is the code:</p><pre><code class="language-sh">EOF=false

echo 'This is a dummy REPL, it does nothing and comes with no warranty.'
until $EOF ; do
        printf '&gt;&gt;&gt; '
        read -r || EOF='true'
        if [ ! &quot;$REPLY&quot; ]; then continue; fi
        echo &quot;$REPLY&quot;
done
# Terminating new line if there was no reply
if [ ! &quot;$REPLY&quot; ]; then echo ''; fi</code></pre><p>The first line is a simple state variable which will be set to <code>true</code> once the
user presses <code>^D</code>. As long as the variable remains <code>false</code> the loop will keep
running.</p><p>Next comes the actual <em>Loop</em> part of the REPL; it prints a prompt and then
reads a line indefinitely. The <em>Read</em> part is implemented using the built-in
<code>read</code> to store the result in the implicit variable <code>$REPLY</code>. Should <code>read</code>
read <code>^D</code> the exist code will be non-zero, causing the conditional <code>||</code> to set
the <code>EOF</code> variable to <code>true</code>. This is our exit mechanism out of the REPL. There
is no <em>Evaluate</em> part since this is a mock REPL (or you could say that any
input evaluates to itself). Finally the <em>Print</em> part is implemented by using
<code>echo</code> to echo back the input.</p><p>Technically the REPL could also be implemented with less code:</p><pre><code class="language-sh">EOF=false
until $EOF ; do
        printf '&gt;&gt;&gt; '
        read -r || EOF='true'
        echo &quot;$REPLY&quot;
done</code></pre><p>The additional code is just to give the REPL some extra polish. It's not really
needed if no human will never use it, but I like the extra touch. The first
line</p><pre><code class="language-sh">if [ ! &quot;$REPLY&quot; ]; then continue; fi</code></pre><p>prevents the loop from reaching the <code>echo</code> if <code>$REPLY</code> is an empty string.
Without it if the user does not enter any text an empty line would be printed:</p><pre><code># Without extra touch
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt;

&gt;&gt;&gt; bar
bar

# With textra touch
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt;
&gt;&gt;&gt; bar
bar</code></pre><p>The other line</p><pre><code class="language-sh">if [ ! &quot;$REPLY&quot; ]; then echo ''; fi</code></pre><p>causes <code>echo</code> to display an empty string. This empty string will move the shell
prompt onto the next line:</p><pre><code># Without extra polish
sh-3.2$ sh mock-repl.sh
This is a dummy REPL, it does nothing and comes with no warranty.
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt; sh-3.2$

# With extra polish
sh-3.2$ sh mock-repl.sh
This is a dummy REPL, it does nothing and comes with no warranty.
&gt;&gt;&gt; foo
foo
&gt;&gt;&gt; ^D
sh-3.2$</code></pre><p>The mock REPL can then be invoked like any other shell script and be used in
place of a real REPL program when testing. That way we do not have to be wary
of any side effects and the developer does not need to have any particular
program installed on their system.</p><footer><hr /><nav><ul class="pager"><li class="previous"><a href="../../../../2017/05/06/introducing-repl-nvim/" rel="prev"><span aria-hidden="true">←</span> Introducing REPL.nvim</a></li><li class="next"><a href="../../../../2017/07/16/functional-fixed-timestep-loop/" rel="next">A purely functional fixed timestep loop <span aria-hidden="true">→</span></a></li></ul></nav></footer></article></main></section><nav class="well"><h1>Blog navigation</h1><nav><h1><a href="/blog/archive/">Archive</a></h1><ul><li><a href="/blog/2019/">2019 (1)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">Categories</a></h1><ul><li><a href="/blog/categories/ntfs-clone/">ntfs-clone (1)</a></li><li><a href="/blog/categories/ips-tools/">ips-tools (1)</a></li><li><a href="/blog/categories/info.vim/">info.vim (1)</a></li><li><a href="/blog/categories/open-source/">open-source (2)</a></li><li><a href="/blog/categories/misc/">misc (4)</a></li><li><a href="/blog/categories/organisation/">organisation (5)</a></li></ul></nav><nav><h1><a href="/blog/tags/">Tags</a></h1><ul><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/website/">website (3)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/outline/">outline (1)</a></li><li><a href="/blog/tags/rant/">rant (1)</a></li><li><a href="/blog/tags/html/">html (1)</a></li><li><a href="/blog/tags/vim/">vim (3)</a></li></ul></nav><aside><strong>Subscribe:</strong> <a href="/blog/rss.xml" type="application/rss+xml">RSS</a></aside></nav></section></section><footer><div class="container"><div class="col-md-8 footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" /></a><p class="text-muted"><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License" /> </a>© 2015-2019, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="col-md-4 footer-social"><span class="pull-right"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img class="img-circle" src="/img/footer/github.png" alt="GitHub" /> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img class="img-circle" src="/img/footer/gitlab.png" alt="GitLab" /> </a></span></div></div></footer></body></html>
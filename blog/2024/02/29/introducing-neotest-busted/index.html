<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>HiPhish's Workshop</title><link rel="stylesheet" href="/css/main.css" type="text/css" media="all"/><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all"/><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all"/></head><body><header><nav id="main-navbar"><input type="checkbox" id="main-nav-hamburger" hidden="hidden"/><div><a href="/">HiPhish's Workshop</a><label for="main-nav-hamburger" hidden="hidden"></label></div><ul><li><a href="/grid-framework/">Grid Framework</a><ul><li><a href="/grid-framework/">Overview</a></li><li hidden="hidden"/><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href=" /grid-framework/news/">News</a></li><li hidden="hidden"/><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li hidden="hidden"/><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li><a href="/#products">Open Source</a><ul><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/IPS-Tools">IPS-Tools</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li><a href="/vim/plugins/">Vim/Nvim plugins</a><ul><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li><li><a href="https://gitlab.com/HiPhish/neovim-guix-channel/">Guix channel</a></li></ul></li><li class="push-end"><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></nav></header><div><div class="blog"><nav class="breadcrumbs" aria-label="Breadcrumbs"><ol><li class=""><a href="../../../../">blog</a></li><li class=""><a href="../../../">2024</a></li><li class=""><a href="../../">02</a></li><li class="active">29</li><li class="active">introducing-neotest-busted</li></ol></nav><main class="blogpost"><article><h1><a href="." title="permalink to Introducing neotest-busted" rel="bookmark">Introducing neotest-busted</a></h1><header class="blog-post-header"><p class="blog-post-published">published: <time datetime="2024-02-29">2024-02-29</time></p><p class="blog-post-category">categories: <a href="../../../../categories/vim/">vim</a></p><p class="blog-post-tags">tags: <a href="../../../../tags/vim/">vim</a>, <a href="../../../../tags/testing/">testing</a></p></header><p>The conclusion of the Neovim &amp; Busted testing sage is coming to a close with
this new plugin: <a href="https://gitlab.com/HiPhish/neotest-busted">neotest-busted</a> (<a href="https://github.com/HiPhish/neotest-busted">GitHub mirror</a>).  In my <a href="/blog/2024/02/20/debugging-lua-scripts-running-in-neovim/">previous post</a> I
mentioned that that I wanted to write a <a href="https://github.com/nvim-neotest/neotest/">Neotest</a> adapter for the <a href="https://lunarmodules.github.io/busted/">busted</a> test
framework, so here it is.</p><p><img src="https://github.com/HiPhish/neotest-busted/assets/4954650/4ca74545-ca95-4e0b-ad32-b8d89c51b4f5" alt="Screenshot of Neovim with Neotest summary window open"/></p><p>And yes, I am using the plugin to test itself.  It was quite thrilling when I
finally started seeing these green checkmarks.</p><h2 id="Features">Features</h2><p>This is as close to a no-configuration plugin as possible.  Everything should
work out of the box once you have the adapter registered in Neotest.</p><ul><li><p>Auto-detects configuration (<code>.busted</code> file)</p></li><li><p>Reloads configuration on change</p></li><li><p>Uses <code>vim.secure</code> for confirmation before executing the configuration file</p></li><li><p>Support for custom busted binary (<code>g:bustedprg</code>) and configuration file
(<code>g:bustedrc</code>)</p></li><li><p>Watch test files and execute them automatically on changes</p></li></ul><p>Debugging is still missing for now.  It should be easy to add (famous last
words), but I wanted to focus on getting testing right first because running
tests is a prerequisite for debugging them.</p><h2 id="Lua is different">Lua is different</h2><p>The tricky part with Lua is getting a script to run in the first place.  Lua is
an embedded language, which means that our scripts normally run inside another
program.  Even the standalone Lua interpreter is just thin layer on top of the
Lua C library.  This raises a problem: how can I run just this one script I
want to test?</p><p>The answer is “it depends”.  With Neovim we can use the <code>-l</code> command-line
option and write a short command-line adapter to use Neovim the way we would
use the standalone interpreter.  This raises another issue though: with all
these hacks and tricks and adapters on top of adapters, how do I know which
part of the chain is broken if things don't work?</p><p>This is why I have added a collection of recipes to the manual of
neotest-busted.  They guide the reader from the simplest possible test scenario
(a standalone Lua script) up to testing Neovim plugins, complete with a
copy &amp; paste ready command-line adapter.</p><p>I would like to extend the recipes over time with other applications like
<a href="https://love2d.org/">LÖVE</a> (if this is even possible) or other languages like <a href="https://fennel-lang.org/">Fennel</a> and
<a href="https://moonscript.org/">Moonscript</a>.  Let us bring testing goodness to other parts of the Lua
ecosystem as well.</p><h2 id="Closing thoughts and an appeal">Closing thoughts and an appeal</h2><p>I am glad this plugin has been written, I just wish it hadn't been me who had
to write it.  There is a big elephant in the room and I have to address it:
documentation.  Both Neotest and busted have very sparse documentation when it
comes to integration.  Neotest is mostly a machine-generated dump of its API,
and while busted does have a good user manual, the schema of the JSON output is
not documented anywhere.  I had to spend a lot of time reading source code,
<code>print</code>ing intermediate values, collecting samples, and making good
old-fashioned educated guesses.  There are probably still some edge cases that
are wrong and only time will uncover them.  I am not saying this to shit on
Neotest or busted specifically, it is a recurring problem and these two just
happend to be the latest instance of it.</p><p>This was very frustrating and time wasting. I don't like to bring my personal
issues into these posts, but I think in this case it is warranted. Honestly, if
I had not been laid off recently I don't think I would have had the patience or
energy to power through it.</p><p>This is a problem.  If we want to build up a healthy Neovim ecosystem we cannot
rely on unemployed programmers to have the time to dig into other people's
code.  Good documentation written <em>in prose</em> is a huge time-saver because the
integrator can focus on implementing the protocols according to spec instead of
having to find out what the spec even is.</p><p>The only person who can write proper documentation is the original author (or a
dedicated technical writer, but I doubt small-scale projects have one).  The
author is the only one who knows what the code is <em>intended</em> to do, everyone
else has a chance of misunderstanding the intention.  I could go into what
makes for good documentation, but the <a href="https://diataxis.fr/">Diataxis</a> concept already describes it
perfectly, it is pretty much what I would have written if I had written it.
The Vim manual is an example of great documentation that matches this concept.
Of course not all points apply to all software projects (you don't need a
tutorial for a colour scheme), but it does make for a good guideline.</p><p>So here is my appeal to plugin authors: please put more effort into
documentation.  If you have difficulty explaining something, how much harder
will it be for someone else to understand it?</p></article><nav class="blog-pager"><a href="/blog/2024/02/20/debugging-lua-scripts-running-in-neovim/" rel="previous" style="float: left"><span aria-hidden="true">←</span> Debugging Lua scripts running in Neovim</a><a href="/blog/2024/08/15/testing-fennel-with-busted-in-lua/" rel="next" style="float: right">Testing Fennel in busted with Lua <span aria-hidden="true">→</span></a></nav></main><nav class="blog-navigation" aria-label="Blog navigation"><aside><span>subscribe:</span> <a href="/blog/rss.xml" type="application/rss+xml">RSS</a></aside><nav><h1><a href="/blog/archive/">archive</a></h1><ul><li><a href="/blog/2024/">2024 (8)</a></li><li><a href="/blog/2023/">2023 (11)</a></li><li><a href="/blog/2022/">2022 (13)</a></li><li><a href="/blog/2021/">2021 (5)</a></li><li><a href="/blog/2020/">2020 (15)</a></li><li><a href="/blog/2019/">2019 (17)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">categories</a></h1><ul><li><a href="/blog/categories/misc/">misc (21)</a></li><li><a href="/blog/categories/open-source/">open-source (24)</a></li><li><a href="/blog/categories/organisation/">organisation (14)</a></li><li><a href="/blog/categories/vim/">vim (23)</a></li></ul></nav><nav><h1><a href="/blog/tags/">tags</a></h1><ul><li><a href="/blog/tags/vim/">vim (21)</a></li><li><a href="/blog/tags/lisp/">lisp (21)</a></li><li><a href="/blog/tags/rant/">rant (14)</a></li><li><a href="/blog/tags/html/">html (10)</a></li><li><a href="/blog/tags/unix/">unix (8)</a></li><li><a href="/blog/tags/lua/">lua (8)</a></li><li><a href="/blog/tags/linux/">linux (5)</a></li><li><a href="/blog/tags/web/">web (4)</a></li><li><a href="/blog/tags/msgpack/">msgpack (3)</a></li><li><a href="/blog/tags/neovim/">neovim (3)</a></li><li><a href="/blog/tags/games/">games (3)</a></li><li><a href="/blog/tags/testing/">testing (3)</a></li><li><a href="/blog/tags/guix/">guix (2)</a></li><li><a href="/blog/tags/network/">network (2)</a></li><li><a href="/blog/tags/markdown/">markdown (2)</a></li><li><a href="/blog/tags/python/">python (2)</a></li><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/awk/">awk (1)</a></li><li><a href="/blog/tags/elixir/">elixir (1)</a></li><li><a href="/blog/tags/wine/">wine (1)</a></li><li><a href="/blog/tags/git/">git (1)</a></li><li><a href="/blog/tags/terminal/">terminal (1)</a></li><li><a href="/blog/tags/unity3d/">unity3d (1)</a></li><li><a href="/blog/tags/functional programming/">functional programming (1)</a></li></ul></nav></nav></div></div><footer><div><div class="footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" height="55"/></a><p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License"/> </a>© 2015-2022, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="footer-social"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img src="/img/footer/github.png" alt="GitHub" height="55"/> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img src="/img/footer/gitlab.png" alt="GitLab" height="55"/> </a></div></div></footer></body></html>
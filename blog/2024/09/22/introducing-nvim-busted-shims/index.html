<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>HiPhish's Workshop</title><link rel="stylesheet" href="/css/main.css" type="text/css" media="all"/><link rel="stylesheet" href="/css/local-nav.css" type="text/css" media="all"/><link rel="stylesheet" href="/css/blog.css" type="text/css" media="all"/></head><body><header><nav id="main-navbar"><input type="checkbox" id="main-nav-hamburger" hidden="hidden"/><div><a href="/">HiPhish's Workshop</a><label for="main-nav-hamburger" hidden="hidden"></label></div><ul><li><a href="/grid-framework/">Grid Framework</a><ul><li><a href="/grid-framework/">Overview</a></li><li hidden="hidden"/><li><a href="/grid-framework/features/">Features</a></li><li><a href="/grid-framework/examples/">Examples</a></li><li><a href="/grid-framework/gallery/">Gallery</a></li><li><a href="/grid-framework/showcase/">Showcase</a></li><li><a href="/grid-framework/faq/">FAQ</a></li><li><a href=" /grid-framework/news/">News</a></li><li hidden="hidden"/><li><a href="http://forum.unity3d.com/threads/grid-framework-scripting-and-editor-plugins.144886/">Support</a></li><li hidden="hidden"/><li><a href="https://www.assetstore.unity3d.com/#/content/62498">Buy Now <span class="badge">35$</span></a></li></ul></li><li><a href="/#products">Open Source</a><ul><li><a href="https://gitlab.com/HiPhish/ntfs-clone">NTFS-Clone</a></li><li><a href="https://gitlab.com/HiPhish/IPS-Tools">IPS-Tools</a></li><li><a href="https://gitlab.com/HiPhish/roll">roll</a></li><li><a href="https://github.com/HiPhish/Newton-method">Newton's Method in C</a></li><li><a href="https://github.com/HiPhish/XeenTools">Xeen Tools</a></li><li><a href="https://github.com/HiPhish/Wolf3DExtract">Wolf3D Extract</a></li><li><a href="https://github.com/HiPhish/Game-Source-Documentation">Game Source Documentation</a></li></ul></li><li><a href="/vim/plugins/">Vim/Nvim plugins</a><ul><li><a href="https://gitlab.com/HiPhish/info.vim">Info.vim</a></li><li><a href="https://gitlab.com/HiPhish/repl.nvim">REPL.nvim</a></li><li><a href="https://gitlab.com/HiPhish/quicklisp.nvim">Quicklisp.nvim</a></li><li><a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a></li><li><a href="https://gitlab.com/HiPhish/neovim-guix-channel/">Guix channel</a></li></ul></li><li class="push-end"><a href="/blog/">Blog</a></li><li><a href="/about/">About</a></li></ul></nav></header><div><div class="blog"><nav class="breadcrumbs" aria-label="Breadcrumbs"><ol><li class=""><a href="../../../../">blog</a></li><li class=""><a href="../../../">2024</a></li><li class=""><a href="../../">09</a></li><li class="active">22</li><li class="active">introducing-nvim-busted-shims</li></ol></nav><main class="blogpost"><article><h1><a href="." title="permalink to Introducing nvim-busted-shims" rel="bookmark">Introducing nvim-busted-shims</a></h1><header class="blog-post-header"><p class="blog-post-published">published: <time datetime="2024-09-22">2024-09-22</time></p><p class="blog-post-category">categories: <a href="../../../../categories/vim/">vim</a></p><p class="blog-post-tags">tags: <a href="../../../../tags/testing/">testing</a>, <a href="../../../../tags/vim/">vim</a>, <a href="../../../../tags/lua/">lua</a></p></header><p>I have written in the past about <a href="/blog/2024/01/29/testing-neovim-plugins-with-busted/">testing Neovim plugins with busted</a>.  In that
post I outlined how to use a thin command-line wrapper shell script around
Neovim to use Neovim as a Lua interpreter and how to configure busted to use it
as the Lua interpreter to run tests in.  In order to avoid having to copy-paste
that snippet over and over again I have created a standalone repository for the
shim: <a href="https://gitlab.com/HiPhish/nvim-busted-shims">nvim-busted-shims</a> (<a href="https://github.com/HiPhish/nvim-busted-shims">GitHub mirror</a>).</p><p>Using it is simple: you add it as a Git submodule to your repository, configure
busted to use the shim <code>lua</code> as the Lua interpreter, and that's it.  The README
has more details, a tutorial and a couple of handy recipes.</p><h2 id="Motivation">Motivation</h2><p>There are other test frameworks and helpers out there, so what makes this one
special?</p><ul><li><p>It piggy-backs on top of busted because busted is already well-established
and works well, no need to re-invent the wheel</p></li><li><p>The implementation is as minimal as possible, that way I can call it “done”
and it will continue to work</p></li><li><p>Users and contributors do not have to add any new plugins to their
configuration</p></li><li><p>Users do not need this submodule at all</p></li></ul><p>Thanks to the minimal design there is really nothing new to learn.  If you
already know how to write busted tests you are good to go.  And if you do not
know busted, you can learn it and write the same kinds of tests for other uses
of Lua.</p><p>Being minimal also means that you probably want to add some helper plugins,
such as <a href="https://gitlab.com/HiPhish/yo-dawg.nvim">yo-dawg</a>.  This repo is not a case of “batteries included” but on the
other hand it means you can pick which helpers you want to use.  Helper plugins
can and should be added as submodules as well.  Again, the README contains more
details.</p><h2 id="More shims">More shims</h2><p>There are three shims included:</p><ul><li><p><code>lua</code> is a wrapper that uses Neovim as a Lua interpreter, this is what you
want for your tests</p></li><li><p><code>busted</code> calls Luarocks first to pick the correct installation of busted in
case  you have installed the package for different Lua versions, use this for
running tests</p></li><li><p><code>nvim</code> is regular Neovim but running in an isolated environment, free from
you personal plugin settings</p></li></ul><p>The <code>nvim</code> shim is useful for running your plugin interactively.  Sometimes you
do not want to run a test but to try things out.</p><h2 id="Eating my own dog food">Eating my own dog food</h2><p>I have been using these shims for testing rainbow-delimiters.nvim, and the
<code>nvim</code> shim has been especially useful.  When a test fails I want to be able to
start up a regular Neovim with UI and see what is going on.  The <code>nvim</code> shim
ensures that my own settings are not affecting what I see.</p><p>Another use-case for the shims is having two copies of a plugin: one I want to
actually use, and one I am working on.  Previously I had to work on the one
plugin as I was using it in order to see the changes.  But now the worked-on
copy of the plugin can reside anywhere outside my configuration.  In order to
try it out I either write a test or I use the <code>nvim</code> shim to poke around.  All
the while the copy in active use remains unchanged.</p><p>I have since ported the tests in
<a href="https://gitlab.com/HiPhish/jinja.vim">jinja.vim</a> to busted, and I will most
likely port other plugins as well.  I hope these shims can help other people
write well-tested plugins as well.</p></article><nav class="blog-pager"><a href="/blog/2024/08/25/lets-write-fizzbuzz-in-functional-style/" rel="previous" style="float: left"><span aria-hidden="true">←</span> Let's write FizzBuzz in a functional style for no good reason</a><a href="/blog/2025/03/24/beware-of-implicit-require-in-neovim-plugins/" rel="next" style="float: right">Beware of 'require' at startup in Neovim plugins <span aria-hidden="true">→</span></a></nav></main><nav class="blog-navigation" aria-label="Blog navigation"><aside><span>subscribe:</span> <a href="/blog/rss.xml" type="application/rss+xml">RSS</a></aside><nav><h1><a href="/blog/archive/">archive</a></h1><ul><li><a href="/blog/2025/">2025 (1)</a></li><li><a href="/blog/2024/">2024 (8)</a></li><li><a href="/blog/2023/">2023 (11)</a></li><li><a href="/blog/2022/">2022 (13)</a></li><li><a href="/blog/2021/">2021 (5)</a></li><li><a href="/blog/2020/">2020 (15)</a></li><li><a href="/blog/2019/">2019 (17)</a></li><li><a href="/blog/2018/">2018 (1)</a></li><li><a href="/blog/2017/">2017 (4)</a></li><li><a href="/blog/2016/">2016 (6)</a></li><li><a href="/blog/2015/">2015 (2)</a></li></ul></nav><nav><h1><a href="/blog/categories/">categories</a></h1><ul><li><a href="/blog/categories/misc/">misc (21)</a></li><li><a href="/blog/categories/open-source/">open-source (24)</a></li><li><a href="/blog/categories/organisation/">organisation (14)</a></li><li><a href="/blog/categories/vim/">vim (24)</a></li></ul></nav><nav><h1><a href="/blog/tags/">tags</a></h1><ul><li><a href="/blog/tags/vim/">vim (21)</a></li><li><a href="/blog/tags/lisp/">lisp (21)</a></li><li><a href="/blog/tags/rant/">rant (14)</a></li><li><a href="/blog/tags/html/">html (10)</a></li><li><a href="/blog/tags/lua/">lua (9)</a></li><li><a href="/blog/tags/unix/">unix (8)</a></li><li><a href="/blog/tags/linux/">linux (5)</a></li><li><a href="/blog/tags/neovim/">neovim (4)</a></li><li><a href="/blog/tags/web/">web (4)</a></li><li><a href="/blog/tags/msgpack/">msgpack (3)</a></li><li><a href="/blog/tags/games/">games (3)</a></li><li><a href="/blog/tags/testing/">testing (3)</a></li><li><a href="/blog/tags/guix/">guix (2)</a></li><li><a href="/blog/tags/network/">network (2)</a></li><li><a href="/blog/tags/markdown/">markdown (2)</a></li><li><a href="/blog/tags/python/">python (2)</a></li><li><a href="/blog/tags/cocoa/">cocoa (1)</a></li><li><a href="/blog/tags/info/">info (1)</a></li><li><a href="/blog/tags/awk/">awk (1)</a></li><li><a href="/blog/tags/elixir/">elixir (1)</a></li><li><a href="/blog/tags/wine/">wine (1)</a></li><li><a href="/blog/tags/git/">git (1)</a></li><li><a href="/blog/tags/terminal/">terminal (1)</a></li><li><a href="/blog/tags/unity3d/">unity3d (1)</a></li><li><a href="/blog/tags/functional programming/">functional programming (1)</a></li></ul></nav></nav></div></div><footer><div><div class="footer-self"><a href="/" title="HiPhish's Workshop"><img src="/img/footer/logo.png" title="HiPhish's Workshop" height="55"/></a><p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img class="copyright-image" src="/img/footer/cc.svg" alt="Creative Commons Attribution-ShareAlike 4.0 International License"/> </a>© 2015-2022, licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></p></div><div class="footer-social"><a href="https://github.com/HiPhish" title="GitHub" target="blank"><img src="/img/footer/github.png" alt="GitHub" height="55"/> </a><a href="https://gitlab.com/HiPhish" title="GitLab" target="blank"><img src="/img/footer/gitlab.png" alt="GitLab" height="55"/> </a></div></div></footer></body></html>
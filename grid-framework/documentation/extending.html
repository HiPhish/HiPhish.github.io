<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Grid Framework: Extending Grid Framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grid Framework
   &#160;<span id="projectnumber">1.8.1</span>
   </div>
   <div id="projectbrief">Easy grid setup and scripting for Unity 3D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('extending.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Extending Grid Framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Grid Framework, much like Unity 3D itself, is written as a multi-purpose framework. You can write your own code and reference Grid Framework's API just as you would reference Unity's API, but sometimes you might find yourself wanting not just to use grid Framework, but to expand on it. Maybe there is some method or variable that would fit greatly in your project but that's too specific for me to include by default.</p>
<p>This is where this section of the manual comes into play. I strongly advise against changing the source code, you will either have to re-apply your changes after each update or refrain from updating and thus miss bug fixes and other improvements. Instead, you should use inheritance or extension methods. While these techniques can be accomplished using UnityScript it is not what the language has been created for. I will use C# in this article and I recommend you to do so as well, since C# was designed with these features in mind.</p>
<h2>Inheritance </h2>
<p>Inheritance is an integral part of object oriented programing, so I won't go into detail, instead I will provide an example. Let's say you you have an array of special points and you want to store them directly inside the (rectangular) grid, as well as a method to output those points. In that case you would inherit from the rectangular grid class and just add the extra code: </p><div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> System.Collections;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ExtendedGrid : <a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a> {</div>
<div class="line">    <span class="keyword">public</span> Vector3[] specialPoints;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> PrintPoints () {</div>
<div class="line">        <span class="keywordflow">if</span> (specialPoints == null)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="keywordflow">foreach</span> (Vector3 point <span class="keywordflow">in</span> specialPoints)</div>
<div class="line">            Debug.Log (point);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Obviously this is not a very useful extension, but you get the idea. Now that we have a custom class we can also create a custom inspector for it. If you don't the default inspector provided by Unity will be displayed, so this step is not mandatory. To create a custom inspector inherit from the base class's inspector and add your extra code to it: </p><div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> UnityEditor;</div>
<div class="line"><span class="keyword">using</span> System; <span class="comment">// needed to the Array class</span></div>
<div class="line"><span class="keyword">using</span> System.Collections;</div>
<div class="line"></div>
<div class="line">[CustomEditor (typeof(ExtendedGrid))]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ExtendedGridEditor : GFRectGridEditor {</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> listSize;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnInspectorGUI () {</div>
<div class="line">        StandardFields ();</div>
<div class="line">        ListField ((ExtendedGrid)grid);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (GUI.changed)</div>
<div class="line">            EditorUtility.SetDirty (target);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> ListField (ExtendedGrid xGrid) {</div>
<div class="line">        <span class="keywordflow">if</span> (xGrid.specialPoints == null)</div>
<div class="line">            xGrid.specialPoints = <span class="keyword">new</span> Vector3[0];</div>
<div class="line"></div>
<div class="line">        listSize = Mathf.Max (EditorGUILayout.IntField (<span class="stringliteral">&quot;Special points amount&quot;</span>, listSize), 0);</div>
<div class="line">        <span class="keywordflow">if</span> (listSize != xGrid.specialPoints.Length) </div>
<div class="line">            Array.Resize&lt;Vector3&gt; (ref xGrid.specialPoints, listSize);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; listSize; i++) {</div>
<div class="line">            xGrid.specialPoints [i] = EditorGUILayout.Vector3Field (<span class="stringliteral">&quot;Special point &quot;</span> + (i+1), xGrid.specialPoints [i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> This inspector lets you set and remove entries to the array in the editor. I will not cover Unity's editor GUI scripting as that topic is outside the scope of this article, but I will explain this example.</p>
<p>Since the extended grid inherits from rectangular grids our new inspector will inherit from the rectangular grid's inspector as well. The private variable keeps track of how long we want the array of points to be. Then we override the <code>OnInspectorGUI</code> method to display all our fields. The method <code>StandardFields</code> simply displays all the fields the base inspector also has, this is handy if you want to use my inspector layout and then just add your own elements to it. If you want more control you should look into the actual code of the inspectors, every group of GUI elements is encapsulated into its own method, so you can mix them as you please. After the standard fields we place our new extra code, again encapsulated into its own method to keep things clean. Finally we finish it up as usual with <code>EditorUtility.SetDirty</code>.</p>
<p>The <code>ListField</code> method takes a parameter of type ExtendedGrid. Each grid inspector holds a reference to its grid object via the <code>grid</code> variable, but its type is the abstract <code><a class="el" href="class_g_f_grid.html" title="Abstract base class for all Grid Framework grids.">GFGrid</a></code>, so we need to typecast it to its more specific runtime type if we want to access the array. The rest of the code is just regular inspector GUI scripting.</p>
<h2>Extension Methods </h2>
<p>Extension methods are a way to add methods to existing classes without having or needing access to the implementation of the class. Once a method has been added this way it will be treated the same way as other methods and it will even show up in autocomplete if your editor supports it. I made use of extension methods in the "lights out" example, you can see a practical application there, here I will go into the theory.</p>
<p>Start by creating a new C# script, the name doesn't matter, so use something that makes sense you, I will use "GridPrintExtension". Delete the default contents of the file created by Unity and add the following code to it: </p><div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> System.Collections;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class </span>GridPrintExtension {</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> That class is where our extension method will be written. Let's write it... </p><div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> System.Collections;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class </span>GridPrintExtension {</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> PrintGrid (<span class="keyword">this</span> <a class="code" href="class_g_f_grid.html">GFGrid</a> grid) {</div>
<div class="line">        Debug.Log (grid.size.x);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Let's go over the code; <code>public</code> should be self-explanatory, the method has to be public so the grid class can see it and it also needs to be static because the containing class is static as well. Next up are the return type, the name of the method and the parameter list. The extension method does not belong to any instance, but the extended class has to treat is as if it did belong to an instance of it. That is what the first parameter is for, it always starts with <code>this</code>, then the the name of the class we extend and finally an identifier which can be any name.</p>
<p>That's essentially it, we can now use this method in our scripting. However, let's take it a step further, what if we want one common method name, but different implementations in every specific grid? In the lights out example each grid type applies different rules as to what an adjacent flied is. We will use a simple if-else construct: </p><div class="fragment"><div class="line"><span class="keyword">using</span> UnityEngine;</div>
<div class="line"><span class="keyword">using</span> System.Collections;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class </span>GridPrintExtension {</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> PrintGrid (<span class="keyword">this</span> <a class="code" href="class_g_f_grid.html">GFGrid</a> grid) {</div>
<div class="line">        Type t = grid.GetType();</div>
<div class="line">        <span class="keywordflow">if</span> (t == typeof(<a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a>)) {</div>
<div class="line">            PrintRect ((<a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a>) grid);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t == typeof(<a class="code" href="class_g_f_hex_grid.html">GFHexGrid</a>)) {</div>
<div class="line">            PrintHex ((<a class="code" href="class_g_f_hex_grid.html">GFHexGrid</a>) grid);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t == typeof(<a class="code" href="class_g_f_polar_grid.html">GFPolarGrid</a>)) {</div>
<div class="line">            PrintPolar ((<a class="code" href="class_g_f_polar_grid.html">GFPolarGrid</a>) grid);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            Debug.Log (grid.size.x);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> PrintRect (<a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a> grid) {</div>
<div class="line">        Debug.Log (grid.spacing.x);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> PrintHex (<a class="code" href="class_g_f_hex_grid.html">GFHexGrid</a> grid) {</div>
<div class="line">        Debug.Log (grid.radius);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> PrintPolar (<a class="code" href="class_g_f_polar_grid.html">GFPolarGrid</a> grid) {</div>
<div class="line">        Debug.Log (grid.sectors);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> The default case is not needed, it's just for demonstration. As you can see we print the contents of a member variable that is specific to a certain grid type without needing to know what type of grid will call the extension method. The specific methods are set to private to make sure they can't be called outside of the extension method, but that's just a matter of personal preference and choice. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 10 2015 23:33:46 for Grid Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>

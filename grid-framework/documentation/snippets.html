<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Grid Framework: Frequently used snippets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grid Framework
   &#160;<span id="projectnumber">1.9.0</span>
   </div>
   <div id="projectbrief">Easy grid setup and scripting for Unity 3D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('snippets.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Frequently used snippets </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Over the years I have been getting similar questions and requests. Not all features requests are suitable to be implemented, they might be too problem-specific or they might not be applicable to all kinds of grids. In this chapter I will collect a number of frequently used snippets.</p>
<p>Unlike the examples these snippets are meant to be copy-pasted and slightly altered according to your needs.</p>
<h2>Limiting an object's position to the grid </h2>
<p>Grids are infinitely large, so we have to manually limit our objects to the visible range. First we will need a way to clamp a vector between a lower and upper limit:</p>
<div class="fragment"><div class="line">Vector3 ClampVector3(Vector3 v, Vector3 lower, Vector3 upper) {</div>
<div class="line">    <span class="keywordflow">return</span> Vector3.Max(lower, Vector3.Min(upper, v));</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here is a snippet for rectangular grids:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> ClampTransform(Transform obj, <a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a> grid) {</div>
<div class="line">    Vector3 from, to;  <span class="comment">// The limits in world coordinates</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (grid.<a class="code" href="class_g_f_grid_acb950aa31097c85e153cd9a642900a31.html#acb950aa31097c85e153cd9a642900a31">useCustomRenderRange</a>) {</div>
<div class="line">        from = -grid.<a class="code" href="class_g_f_grid_a336f54e5b5f677871876dc3d90cc611d.html#a336f54e5b5f677871876dc3d90cc611d">size</a>;</div>
<div class="line">        to   =  grid.<a class="code" href="class_g_f_grid_a336f54e5b5f677871876dc3d90cc611d.html#a336f54e5b5f677871876dc3d90cc611d">size</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        from =  grid.<a class="code" href="class_g_f_grid_a4556eac3905975b9024addb169c629d8.html#a4556eac3905975b9024addb169c629d8">renderFrom</a>;</div>
<div class="line">        to   =  grid.<a class="code" href="class_g_f_grid_af9ec4b040505718f58a7841087d9b72a.html#af9ec4b040505718f58a7841087d9b72a">renderTo</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Convert to grid-units if the length is in world-units</span></div>
<div class="line">    <span class="keywordflow">if</span> (!grid.<a class="code" href="class_g_f_grid_a65d207e3957240c935645db01a199419.html#a65d207e3957240c935645db01a199419">relativeSize</a>) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i) {</div>
<div class="line">            from[i] /= spacing[i];</div>
<div class="line">              to[i] /= spacing[i];</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We must also take into account the size of the object itself</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i) {</div>
<div class="line">        from[i] += obj.lossyScale[i] / 2.0f * spacing[i];</div>
<div class="line">          to[i] -= obj.lossyScale[i] / 2.0f * spacing[i];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Now convert the result to world-coordinates</span></div>
<div class="line">    from = grid.<a class="code" href="class_g_f_rect_grid_afe97547b7a3cc0d070503d245d0e3e4b.html#afe97547b7a3cc0d070503d245d0e3e4b">GridToWorld</a>(from);</div>
<div class="line">    to   = grid.<a class="code" href="class_g_f_rect_grid_afe97547b7a3cc0d070503d245d0e3e4b.html#afe97547b7a3cc0d070503d245d0e3e4b">GridToWorld</a>(to  );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Clamp the object</span></div>
<div class="line">    ClampVector3(obj.position, from, to);</div>
<div class="line">}</div>
</div><!-- fragment --><p>For non-rectangular grids the shape of an object's bounding box (a cuboid) does not match the shape of the grid, so you have to decide for your game specifically how to handle objects at the edge of the grid (line 19 and on).</p>
<h2>Clicking a tile of the grid </h2>
<p>There are many ways of getting input in Unity. My personal choice is raycasting: a collider is placed to line up with the grid and a ray is cast through the cursor. Where the ray hits the collider we convert the position to grid-coordinates.</p>
<p>First attach a collider component to your grid. Any collider works, but I use either a plane collider or a generated mesh collider. Make sure the plane or mesh is facing the right way, otherwise your ray will just pass through.</p>
<p>We will then cast a ray that can <em>only</em> collide with this collider. You can set the layer of the collider to something other objects in the game can't collide with if you want to.</p>
<div class="fragment"><div class="line">Vector3 ClickGrid(<a class="code" href="class_g_f_grid.html">GFGrid</a> grid, Collider coll) {</div>
<div class="line">    RaycastHit hit;   <span class="comment">// Store raycast results here</span></div>
<div class="line">    Vector3    tile;  <span class="comment">// Tile that has been clicked</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Ray from cursor position and camera angle</span></div>
<div class="line">    Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Perform the raycast</span></div>
<div class="line">    <span class="keywordflow">if</span> (coll.Raycast(ray, hit, 100.0)) {</div>
<div class="line">        tile = hit.point;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Convert to grid coordinates</span></div>
<div class="line">    <span class="keywordflow">return</span> grid.<a class="code" href="class_g_f_grid_a81cec06aaa87e7984b83b8f3f718cd9a.html#a81cec06aaa87e7984b83b8f3f718cd9a">WorldToGrid</a>(tile);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Pathfinding using Aaron Granberg's <em>A-star Pathfinding</em> </h2>
<p>This popular <a href="http://arongranberg.com/astar/">pathfinding plugin</a> has five types of pathfinding graphs: grid, mesh, point, recast and layered. Out of these only the grid-graph can be built from data rather than geometry and it is limited to a two-dimensional rectangle, i.e. no shearing.</p>
<p>The following snippet will generate a <em>XZ</em>-grid graph from a <code><a class="el" href="class_g_f_rect_grid.html" title="A standard three-dimensional rectangular grid.">GFRectGrid</a></code> instance. Make sure you have an <em>AStar Pathfinding</em> object in your scene.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> AstarData AstarDataFromGFRectGrid(<a class="code" href="class_g_f_rect_grid.html">GFRectGrid</a> grid) {</div>
<div class="line">    var data = AstarPath.active.astarData;</div>
<div class="line">    var gg = data.AddGraph(typeof(GridGraph)) as GridGraph;</div>
<div class="line"></div>
<div class="line">    var width = grid.<a class="code" href="class_g_f_grid_acb950aa31097c85e153cd9a642900a31.html#acb950aa31097c85e153cd9a642900a31">useCustomRenderRange</a> ?</div>
<div class="line">                Mathf.RoundToInt(grid.<a class="code" href="class_g_f_grid_af9ec4b040505718f58a7841087d9b72a.html#af9ec4b040505718f58a7841087d9b72a">renderTo</a>.x - grid.<a class="code" href="class_g_f_grid_a4556eac3905975b9024addb169c629d8.html#a4556eac3905975b9024addb169c629d8">renderFrom</a>.x)</div>
<div class="line">                :</div>
<div class="line">                Mathf.RoundToInt(grid.<a class="code" href="class_g_f_grid_a336f54e5b5f677871876dc3d90cc611d.html#a336f54e5b5f677871876dc3d90cc611d">size</a>.x);</div>
<div class="line"></div>
<div class="line">    var depth = grid.<a class="code" href="class_g_f_grid_acb950aa31097c85e153cd9a642900a31.html#acb950aa31097c85e153cd9a642900a31">useCustomRenderRange</a> ?</div>
<div class="line">                Mathf.RoundToInt(grid.<a class="code" href="class_g_f_grid_af9ec4b040505718f58a7841087d9b72a.html#af9ec4b040505718f58a7841087d9b72a">renderTo</a>.z - grid.<a class="code" href="class_g_f_grid_a4556eac3905975b9024addb169c629d8.html#a4556eac3905975b9024addb169c629d8">renderFrom</a>.z)</div>
<div class="line">                :</div>
<div class="line">                Mathf.RoundToInt(grid.<a class="code" href="class_g_f_grid_a336f54e5b5f677871876dc3d90cc611d.html#a336f54e5b5f677871876dc3d90cc611d">size</a>.y);</div>
<div class="line"></div>
<div class="line">    gg.width       = width;</div>
<div class="line">    gg.depth       = depth;</div>
<div class="line">    gg.nodeSize    = 1;</div>
<div class="line">    gg.aspectRatio = grid.<a class="code" href="class_g_f_rect_grid_a149aa6bd8f08def54ce1b9dd843b6421.html#a149aa6bd8f08def54ce1b9dd843b6421">spacing</a>.x / grid.<a class="code" href="class_g_f_rect_grid_a149aa6bd8f08def54ce1b9dd843b6421.html#a149aa6bd8f08def54ce1b9dd843b6421">spacing</a>.z;</div>
<div class="line">    gg.center      = grid.<a class="code" href="class_g_f_rect_grid_afe97547b7a3cc0d070503d245d0e3e4b.html#afe97547b7a3cc0d070503d245d0e3e4b">GridToWorld</a>(Vector3.zero);</div>
<div class="line"></div>
<div class="line">    gg.UpdateSizeFromWidthDepth();</div>
<div class="line">    AstarPath.active.Scan();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> data;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Dec 11 2015 22:48:06 for Grid Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
